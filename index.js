const TelegramBot = require('node-telegram-bot-api');
require('http').createServer().listen(process.env.PORT || 5000).on('request', function(req, res){
  res.end('')
})
const dataBot = {
  mes: {
    welcomeMessage: `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä!
–ú–µ–Ω—è –∑–æ–≤—É—Ç –í–∏–∫—Ç–æ—Ä, —è –≥–æ—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –í–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã.`,
    post: '–ü–æ—è–≤–∏–ª–æ—Å—å –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è —Ç–µ–±—è!',
  },
  questions: {
    Q1: `üí∞üìà*–ü–æ—á–µ–º—É –¥–æ—Ä–æ–∂–∞—é—Ç —Å—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª—ã?*
    
    –ü–æ–¥–æ—Ä–æ–∂–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –≥—Ä—É–ø–ø —Å—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –æ–±—É—Å–ª–æ–≤–ª–µ–Ω–æ —Ä—è–¥–æ–º —Ñ–∞–∫—Ç–æ—Ä–æ–≤, –∫–ª—é—á–µ–≤—ã–º–∏ –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —è–≤–ª—è–µ—Ç—Å—è –¥–µ—Ñ–∏—Ü–∏—Ç —Å—ã—Ä—å—è –∏ —Ä–æ—Å—Ç –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞—Ç—Ä–∞—Ç, —Ä–∞—Å—Å–∫–∞–∑–∞–ª –∂—É—Ä–Ω–∞–ª–∏—Å—Ç–∞–º —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –≥—Ä—É–ø–ø—ã –ö–ù–ê–£–§ –í–æ—Å—Ç–æ—á–Ω–∞—è –ï–≤—Ä–æ–ø–∞ –∏ –°–ù–ì –Ø–Ω–∏—Å –ö—Ä–∞—É–ª–∏—Å.

    –¢–∞–∫, –Ω–∞ 30% –≤ —ç—Ç–æ–º –≥–æ–¥—É –≤—ã—Ä–æ—Å–ª–∏ —Ü–µ–Ω—ã –Ω–∞ –º–µ—Ç–∞–ª–ª, —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ–¥–æ—Ä–æ–∂–∞–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ö–∏–º–∏—á–µ—Å–∫–∏–µ —Å—É–±—Å—Ç–∞–Ω—Ü–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ö–ª–æ—Ä. –í –æ–±–æ–∏—Ö —Å–ª—É—á–∞—è—Ö –ø—Ä–∏—á–∏–Ω–æ–π —Å—Ç–∞–ª–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–æ—â–Ω–æ—Å—Ç–µ–π.
    
    –ë–æ–ª—å—à—É—é –ø—Ä–æ–±–ª–µ–º—É –¥–ª—è –º–Ω–æ–≥–∏—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –Ω–∞ –º–∞–∫—É–ª–∞—Ç—É—Ä—É, –≤—ã–∑–≤–∞–Ω–Ω–æ–µ –ø–∞–Ω–¥–µ–º–∏–µ–π. ¬´–¶–µ–Ω–∞ –¥–ª—è –Ω–∞—Å –≤—ã—Ä–æ—Å–ª–∞ –Ω–∞ 60%. –ú–∞–∫—É–ª–∞—Ç—É—Ä—ã –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç, —á–∞—Å—Ç–∏—á–Ω–æ –º—ã —Å–µ–π—á–∞—Å –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –µ–µ –∏–∑-–∑–∞ —Ä—É–±–µ–∂–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ –ü—Ä–∏–±–∞–ª—Ç–∏–∫–∏¬ª, ‚Äî –ø–æ—è—Å–Ω–∏–ª –ö—Ä–∞—É–ª–∏—Å. –ë–æ–ª—å—à–µ —á–µ–º –Ω–∞ 12% –≤—ã—Ä–æ—Å–ª–∞ —Ü–µ–Ω–∞ –Ω–∞ –¥—Ä–µ–≤–µ—Å–∏–Ω—É, –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –¥–ª—è –ø–æ–¥–¥–æ–Ω–æ–≤.
    
  –ü–æ–¥—Ä–æ–±–Ω–µ–µ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å üëá
  https://www.youtube.com/watch?v=SirWguFYM7Y&t=2s`,

    Q2:`üèòüß±*–ò–∑ —á–µ–≥–æ —Å—Ç—Ä–æ–∏—Ç—å –∑–∞–≥–æ—Ä–æ–¥–Ω—ã–π –¥–æ–º?*

_–ß—Ç–æ –Ω—É–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –¥–ª—è —Å—Ç–µ–Ω –¥–æ–º–∞_
    –°—Ç–µ–Ω—ã –∑–∞–±–∏—Ä–∞—é—Ç –¥–æ —á–µ—Ç–≤–µ—Ä—Ç–∏ –≤—Å–µ—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤—É –¥–æ–º–∞. –ò –µ—Å–ª–∏ –±–µ—Å–ø–µ—á–Ω–æ –æ—Ç–Ω–µ—Å—Ç–∏—Å—å –∫ —ç—Ç–æ–º—É –≤—ã–±–æ—Ä—É, —Ç–æ –º–æ–∂–Ω–æ –ø–æ–Ω–µ—Å—Ç–∏ —Å–µ—Ä—å–µ–∑–Ω—ã–µ —Ç—Ä–∞—Ç—ã –≤ –±—É–¥—É—â–µ–º. –ü–æ—ç—Ç–æ–º—É —É—á—Ç–µ–º –∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤–∞–∂–Ω–µ–π—à–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –∏ —Ñ–∞–∫—Ç–æ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –¥–ª—è –≤–æ–∑–≤–µ–¥–µ–Ω–∏—è —Å—Ç–µ–Ω –¥–æ–º–∞.

    #1.*–í–æ–ø—Ä–æ—Å —Ü–µ–Ω—ã.* –ó–∞—Ç—Ä–∞—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å —Å–Ω–∏–∂–µ–Ω—ã, –µ—Å–ª–∏ –≤–∑—è—Ç—å –¥–ª—è —Å—Ç–µ–Ω –æ–±–ª–µ–≥—á–µ–Ω–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª. –¢–æ–≥–¥–∞ –Ω–µ –ø—Ä–∏–¥–µ—Ç—Å—è —Å–æ–æ—Ä—É–∂–∞—Ç—å –º–æ—â–Ω—ã–π –∏ –¥–æ—Ä–æ–≥–æ–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç.

    #2.*–¢–µ–ø–ª–æ–∏–∑–æ–ª—è—Ü–∏—è.* –•–æ–ª–æ–¥–Ω—ã–µ —Å—Ç–µ–Ω—ã –æ–±–æ–π–¥—É—Ç—Å—è –∑–∏–º–æ–π —Å–ª–∏—à–∫–æ–º –¥–æ—Ä–æ–≥–æ. –ü–æ—ç—Ç–æ–º—É, –ø—Ä–µ–∂–¥–µ —á–µ–º –≤—ã–±—Ä–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤—Å–µ —Ä–∞—Å—á–µ—Ç—ã, –æ—Ä–∏–µ–Ω—Ç–∏—Ä—É—è—Å—å –Ω–∞ –º–µ—Å—Ç–Ω—ã–µ –∫–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è. –î–æ–±–∏—Ç—å—Å—è –Ω—É–∂–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏ —Ç–µ–ø–ª–æ–∏–∑–æ–ª—è—Ü–∏–∏ –º–æ–∂–Ω–æ –ø—Ä–∏–±–µ–≥–Ω—É–≤ –∫ –ø–æ–º–æ—â–∏ —É—Ç–µ–ø–ª–∏—Ç–µ–ª–µ–π. –ï—Å–ª–∏ –≤–∑—è—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª —Å —Ö–æ—Ä–æ—à–∏–º–∏ —Ç–µ–ø–ª–æ–∏–∑–æ–ª–∏—Ä—É—é—â–∏–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏, —Ç–æ —Å—Ç–µ–Ω—ã –º–æ–∂–Ω–æ –Ω–µ —É—Ç–µ–ø–ª—è—Ç—å, –Ω–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–≥–∏–æ–Ω–∞ –∑–∞—Å—Ç—Ä–æ–π–∫–∏.

    #3.*–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã.* –ó–∞—Ç—Ä–∞—Ç—ã –≤—Ä–µ–º–µ–Ω–∏ –∏ —Å–∏–ª –º–æ–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å, –µ—Å–ª–∏ —Å–ª–æ–∂–∏—Ç—å —Å—Ç–µ–Ω—ã –∏–∑ –±–æ–ª—å—à–∏—Ö –±–ª–æ–∫–æ–≤, –∞ –Ω–µ –∏–∑ –º–µ–ª–∫–æ—à—Ç—É—á–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤. –¢–∞–∫–∏–µ —Å—Ç–µ–Ω—ã –≤–æ–∑–≤–æ–¥—è—Ç—Å—è 3 - 4 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ –∏ –ª–µ–≥—á–µ. –°–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å - –ø—Ä–∏ –≤–æ–∑–≤–µ–¥–µ–Ω–∏–∏ –∫–∞—Ä–∫–∞—Å–Ω—ã—Ö –ø–∞–Ω–µ–ª—å–Ω—ã—Ö —Å—Ç–µ–Ω.

    #4.*–ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –æ—Ç–¥–µ–ª–∫—É.* –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≥–ª–∞–¥–∫–∏–µ –∏ —ç—Å—Ç–µ—Ç–∏—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –æ—Ç–¥–µ–ª–∫–∏ —Å—Ç–µ–Ω. –ù–∞ —ç—Ç–æ–º –º–æ–∂–Ω–æ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å.
    –ü–æ–¥—Ä–æ–±–Ω–µ–µ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å üëá
    https://www.youtube.com/watch?v=vr5seenxurk&t=22s`
  }
};

const dataBase = {
  users: [],
};

const bot = new TelegramBot(process.env.TOKEN_MINIMELTS_BOT, { polling: true });

const questions = {
  reply_markup: {
    inline_keyboard: [
      [
        { 
          text: '–ü–æ—á–µ–º—É –¥–æ—Ä–æ–∂–∞—é—Ç —Å—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª—ã?', 
          callback_data: '–ü–æ—á–µ–º—É –¥–æ—Ä–æ–∂–∞—é—Ç —Å—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª—ã?' 
        }
      ],
      [
        { 
          text: '–ò–∑ —á–µ–≥–æ —Å—Ç—Ä–æ–∏—Ç—å –∑–∞–≥–æ—Ä–æ–¥–Ω—ã–π –¥–æ–º?', 
          callback_data: '–ò–∑ —á–µ–≥–æ —Å—Ç—Ä–æ–∏—Ç—å –∑–∞–≥–æ—Ä–æ–¥–Ω—ã–π –¥–æ–º?' 
        }
      ],
    ],
  },
};

bot.on('callback_query', async (msg) => {
  // console.log('msg', msg);
  // console.log('msg.data', msg.data);
  const chatId = msg.message.chat.id;

  switch (msg.data) {
    case '–ü–æ—á–µ–º—É –¥–æ—Ä–æ–∂–∞—é—Ç —Å—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª—ã?':
      await bot.sendMessage(chatId, dataBot.questions.Q1, { parse_mode: 'Markdown' });
      break
  
    case '–ò–∑ —á–µ–≥–æ —Å—Ç—Ä–æ–∏—Ç—å –∑–∞–≥–æ—Ä–æ–¥–Ω—ã–π –¥–æ–º?':
      await bot.sendMessage(chatId, dataBot.questions.Q2, { parse_mode: 'Markdown' });
      break
  
    default:
      await bot.sendMessage(chatId, '–ù–µ –ø–æ–Ω—è–ª –≤–æ–ø—Ä–æ—Å–∞?!');
  }
  return
});

const start = () => {
  bot.on('message', async (msg) => {
    const chatId = msg.chat.id;
    const firstName = msg.chat.first_name;
    const { text } = msg;

    const newUser = {
      chatId,
      name: firstName,
    };

    if (text === '/start') {
      // isNewUser?
      const res = dataBase.users.filter(el => el.chatId === chatId);
      if (res.length === 0) dataBase.users.push(newUser);
      console.log('dataBase', dataBase);

      await bot.sendSticker(chatId, 'https://tlgrm.ru/_/stickers/b93/f0a/b93f0a6a-0c6b-3fab-b9d9-c11cf6394f3b/6.webp');
      await bot.sendMessage(chatId, `${msg.from.first_name}, ${dataBot.mes.welcomeMessage}`, { parse_mode: 'Markdown' });
      setTimeout(() => {
        return bot.sendMessage(chatId, '–ß—Ç–æ –í–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç? üßê', questions);
      }, 3000)
      return
      // return bot.sendMessage(chatId, '–ß—Ç–æ –í–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç? üßê', questions);
    }

    bot.sendMessage(chatId, '–í—ã –≤–≤–µ–ª–∏ –Ω–µ–ø–æ–Ω—è—Ç–Ω—É—é –º–Ω–µ –∫–æ–º–∞–Ω–¥—É!)');
  });
};

start();

module.exports = bot;
